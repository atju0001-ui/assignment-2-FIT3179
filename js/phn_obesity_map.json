{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {"text": "Crude Obesity â€” States & PHN Areas (Adults, 2022)", "anchor": "start"},

  "params": [
    {
      "name": "pState",
      "value": "Queensland",
      "bind": {
        "input": "select",
        "name": "Highlight State: ",
        "options": [
          "New South Wales",
          "Victoria",
          "Queensland",
          "South Australia",
          "Western Australia",
          "Tasmania",
          "Northern Territory"
        ]
      }
    }
  ],

  "width": 720,
  "height": 520,
  "projection": {"type": "mercator"},
  "data": {
    "url": "data/australia_states.topojson",
    "format": {"type": "topojson", "feature": "STE_2021_AUST_GDA2020"}
  },
  "transform": [
    {
      "calculate": "datum.properties.STE_NAME21 || datum.properties.STATE_NAME || datum.properties.STE_NAME || datum.properties.NAME",
      "as": "StateName"
    },
    {
      "calculate": "datum.StateName === 'Victoria' ? 'VIC' : datum.StateName === 'Queensland' ? 'QLD' : datum.StateName === 'South Australia' ? 'SA' : datum.StateName === 'Western Australia' ? 'WA' : datum.StateName === 'Tasmania' ? 'TAS' : datum.StateName === 'Northern Territory' ? 'NT' : datum.StateName === 'New South Wales' ? 'ACT' : null",
      "as": "StateCode"
    },
    {
      "lookup": "StateCode",
      "from": {
        "data": {
          "url": "data/aihw_s9_phn_obesity_2022.csv",
          "format": {"type": "csv"}
        },
        "key": "State",
        "fields": ["Crude_percent"]
      },
      "as": ["Crude_percent"]
    },
    {"calculate": "isValid(datum.Crude_percent) ? toNumber(datum.Crude_percent) : null", "as": "Crude_num"}
  ],
  "layer": [
    {
      "mark": {"type": "geoshape", "stroke": "#D1D5DB", "strokeWidth": 0.8},
      "encoding": {
        "color": {
          "field": "Crude_num",
          "type": "quantitative",
          "title": "Crude obesity (%)",
          "scale": {"scheme": "browns"}
        },
        "tooltip": [
          {"field": "StateName", "title": "State/Territory"},
          {"field": "Crude_num", "title": "Crude (%)", "format": ".1f"}
        ]
      }
    },
    {
      "transform": [{"filter": "datum.StateName === pState"}],
      "mark": {"type": "geoshape", "fill": null, "stroke": "#0f172a", "strokeWidth": 3}
    }
  ],

  "config": {"view": {"stroke": null}, "axis": {"labelFontSize": 11, "titleFontSize": 12}}
}
