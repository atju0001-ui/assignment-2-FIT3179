{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 820,
  "height": 420,
  "title": "Overweight & Obesity — Adults vs Children (AIHW)",

  "params": [
    {
      "name": "pPop",
      "value": "Adults",
      "bind": {"input": "select", "options": ["Adults", "Children and adolescents"], "name": "Population: "}
    },
    {
      "name": "pMeasure",
      "value": "Overweight or obese",
      "bind": {"input": "select", "options": ["Obese", "Overweight but not obese", "Overweight or obese"], "name": "Measure: "}
    }
  ],

  "resolve": { "scale": { "x": "independent", "color": "independent" } },

  "layer": [
   
    {
      "data": {
        "url": "data/aihw_s2_phn_obesity.csv",
        "format": { "type": "csv" }
      },
      "transform": [
        {
          "fold": [
            "Men - Overweight but not obese (%)",
            "Men - Obese (%)",
            "Men - Overweight or obese (%)",
            "Women - Overweight but not obese (%)",
            "Women - Obese (%)",
            "Women - Overweight or obese (%)",
            "Persons - Overweight but not obese (%)",
            "Persons - Obese (%)",
            "Persons - Overweight or obese (%)"
          ],
          "as": ["Metric", "valRaw"]
        },
        { "calculate": "pMeasure + ' (%)'", "as": "MeasureSuffix" },
        { "filter": "indexof(datum.Metric, datum.MeasureSuffix) >= 0" },
        { "calculate": "replace(datum.Metric, ' - ' + datum.MeasureSuffix, '')", "as": "Group" },
        { "filter": "pPop === 'Adults'" },
        { "filter": "indexof(['Men','Women','Persons'], datum.Group) >= 0" },
        { "filter": "indexof(['18–24','25–34','35–44','45–54','55–64','65 and over'], datum['Age group']) >= 0" },
        { "calculate": "toNumber(replace(replace(toString(datum.valRaw), '%',''), ',','.'))", "as": "Percent" },
        { "filter": "isValid(datum.Percent)" }
      ],
      "mark": { "type": "line", "point": true },
      "encoding": {
        "x": {
          "field": "Age group",
          "type": "ordinal",
          "sort": ["18–24","25–34","35–44","45–54","55–64","65 and over"],
          "axis": null
        },
        "y": { "field": "Percent", "type": "quantitative", "title": "Per cent" },
        "color": { "field": "Group", "type": "nominal", "legend": null },
        "tooltip": [
          { "field": "Group", "title": "Sex" },
          { "field": "Age group", "title": "Age group" },
          { "field": "Percent", "title": "Per cent", "format": ".1f" },
          { "expr": "pMeasure", "title": "Measure" },
          { "value": "Adults", "title": "Population" }
        ]
      }
    },

    
    {
      "data": {
        "url": "data/aihw_s11_phn_obesity.csv",
        "format": { "type": "csv" }   
      },
      "transform": [
        {
          "fold": [
            "Boys - Overweight but not obese (%)",
            "Boys - Obese (%)",
            "Boys - Overweight or obese (%)",
            "Girls - Overweight but not obese (%)",
            "Girls - Obese (%)",
            "Girls - Overweight or obese (%)",
            "All children - Overweight but not obese (%)",
            "All children - Obese (%)",
            "All children - Overweight or obese (%)"
          ],
          "as": ["Metric", "valRaw"]
        },
        { "calculate": "pMeasure + ' (%)'", "as": "MeasureSuffix" },
        { "filter": "indexof(datum.Metric, datum.MeasureSuffix) >= 0" },
        { "calculate": "replace(datum.Metric, ' - ' + datum.MeasureSuffix, '')", "as": "Group" },
        { "filter": "pPop === 'Children and adolescents'" },
        { "filter": "indexof(['Boys','Girls','All children'], datum.Group) >= 0" },
        { "filter": "indexof(['2–4','5–7','8–11','12–15','16–17'], datum['Age group']) >= 0" },
        { "calculate": "toNumber(replace(replace(toString(datum.valRaw), '%',''), ',','.'))", "as": "Percent" },
        { "filter": "isValid(datum.Percent)" }
      ],
      "mark": { "type": "line", "point": true },
      "encoding": {
        "x": {
          "field": "Age group",
          "type": "ordinal",
          "sort": ["2–4","5–7","8–11","12–15","16–17"],
          "axis": null
        },
        "y": { "field": "Percent", "type": "quantitative", "title": "Per cent" },
        "color": { "field": "Group", "type": "nominal", "legend": null },
        "tooltip": [
          { "field": "Group", "title": "Sex" },
          { "field": "Age group", "title": "Age group" },
          { "field": "Percent", "title": "Per cent", "format": ".1f" },
          { "expr": "pMeasure", "title": "Measure" },
          { "value": "Children and adolescents", "title": "Population" }
        ]
      }
    },

    
    {
      "data": {
        "values": [
          {"Population":"Adults","Age group":"18–24"},
          {"Population":"Adults","Age group":"25–34"},
          {"Population":"Adults","Age group":"35–44"},
          {"Population":"Adults","Age group":"45–54"},
          {"Population":"Adults","Age group":"55–64"},
          {"Population":"Adults","Age group":"65 and over"},
          {"Population":"Children and adolescents","Age group":"2–4"},
          {"Population":"Children and adolescents","Age group":"5–7"},
          {"Population":"Children and adolescents","Age group":"8–11"},
          {"Population":"Children and adolescents","Age group":"12–15"},
          {"Population":"Children and adolescents","Age group":"16–17"}
        ]
      },
      "transform": [
        { "filter": "datum.Population === pPop" }
      ],
      "mark": { "type": "point", "opacity": 0 },
      "encoding": {
        "x": {
          "field": "Age group",
          "type": "ordinal",
          "title": "Age group",
          "sort": ["2–4","5–7","8–11","12–15","16–17","18–24","25–34","35–44","45–54","55–64","65 and over"],
          "axis": { "orient": "bottom" }
        }
      }
    },

    
    {
      "data": {
        "values": [
          {"Population":"Adults","Group":"Men"},
          {"Population":"Adults","Group":"Women"},
          {"Population":"Adults","Group":"Persons"},
          {"Population":"Children and adolescents","Group":"Boys"},
          {"Population":"Children and adolescents","Group":"Girls"},
          {"Population":"Children and adolescents","Group":"All children"}
        ]
      },
      "transform": [
        { "filter": "datum.Population === pPop" }
      ],
      "mark": { "type": "point", "opacity": 0 },
      "encoding": {
        "color": { "field": "Group", "type": "nominal", "title": "Sex" }
      }
    },

    
    {
      "data": {"values":[{}]},
      "mark": {
        "type": "rect",
        "cornerRadius": 6,
        "opacity": 0.92,
        "stroke": "#bfb08a",
        "fill": "#fff9e6"
      },
      "encoding": {
        "x":  { "value": 520 },   
        "x2": { "value": 838 },   
        "y":  { "value": 275 },   
        "y2": { "value": 410 }    
      }
    },

   
    {
      "data": {"values":[{}]},
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "top",
        "font": "sans-serif",
        "fontSize": 12,
        "fontWeight": "bold"
      },
      "encoding": {
        "x": { "value": 530 },
        "y": { "value": 285 },
        "text": { "value": "SUMMARY" }
      }
    },

    
    {
      "data": {"values":[{}]},
      "mark": {
        "type": "text",
        "align": "left",
        "baseline": "top",
        "font": "sans-serif",
        "fontSize": 12,
        "lineBreak": "\n"
      },
      "encoding": {
        "x": { "value": 530 },
        "y": { "value": 305 },
        "text": {
          "value":
"Overweight and obesity increase sharply with age.\nAdults show the highest combined rates after 45,\nreaching over 70% by age 55–64.\nChildren’s rates are lower overall but rise steadily\nthrough adolescence, peaking around 12–17 years.\nMales generally record slightly higher levels than females."

        }
      }
    }
  ],

  "config": {
    "axis": { "labelFontSize": 11, "titleFontSize": 12 },
    "legend": { "title": "Sex" },
    "title": { "anchor": "start", "fontSize": 16 },
    "view": { "stroke": null }
  }
}
